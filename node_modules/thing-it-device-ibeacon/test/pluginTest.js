var assert = require("assert");

describe('[thing-it] iBeacon', function () {
    var testDriver;

    before(function () {
        testDriver = require("thing-it-test").createTestDriver({logLevel: "error"});

        testDriver.registerDevicePlugin(__dirname + "/../ibeacon");
    });
    describe('Start Configuration', function () {
        it('should complete without error', function () {
            return testDriver.start({
                configuration: require("../examples/configuration.js"),
                heartbeat: 10,
                //simulated: true
            });
        });
    });
    //describe('iBeacon Discovery', function () {
    //    this.timeout(80000);
    //
    //    before(function () {
    //        testDriver.removeAllListeners();
    //    });
    //    it('should produce Device Discovery message', function (done) {
    //        testDriver.addListener({
    //            publishDeviceRegistration: function (device) {
    //                done();
    //            }
    //        });
    //    });
    //});
    describe('State Notification', function () {
        this.timeout(60000);

        before(function () {
            testDriver.removeAllListeners();
        });
        it('should produce Device State Change Message', function (done) {
            testDriver.addListener({
                publishDeviceStateChange: function (device) {
                    done();
                }
            });
        });
    });
});





