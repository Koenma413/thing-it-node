/**
 *
 * @constructor
 */
function SettingsPage() {
    /**
     *
     */
    SettingsPage.prototype.initialize = function (console) {
        this.id = "settings";
        this.console = console;

        return this;
    };

    /**
     *
     */
    SettingsPage.prototype.show = function () {
        var deferred = $.Deferred();

        this.server = this.console.consoleService.settings.server;
        this.host = this.console.consoleService.settings.host;
        this.port = this.console.consoleService.settings.port;

        if (this.server === "local")
        {
            this.serverMode = "local";
        }
        else {
            if (this.server.indexOf("thing-it.com") >= 0)
            {
                this.serverMode = "tic";
            } else {
                this.serverMode = "test";
            }
        }

        deferred.resolve();

        return deferred.promise();
    };

    /**
     *
     */
    SettingsPage.prototype.leave = function () {
    };

    /**
     *
     */
    SettingsPage.prototype.openSettingsDialog = function () {
        this.console.Ui.turnOn("serverSettingsDialog");
    };

    /**
     *
     */
    SettingsPage.prototype.onServerModeChange = function () {
        if (this.serverMode === "tic")
        {
            this.server = "proxy";
            this.host = "www.thing-it.com";
            this.port = 80;
        }
        else if (this.serverMode === "local")
        {
            this.server = "local";
            this.host = "192.168.1.3";
            this.port = 3001;
        }
        else if (this.serverMode === "test")
        {
            this.server = "proxy";
            this.host = "192.168.1.3";
            this.port = 3000;
        }
    };

    /**
     *
     */
    SettingsPage.prototype.applySettings = function () {
        if (!this.host || !this.port) {
            return;
        }

        this.console.consoleService.settings.server = this.server;
        this.console.consoleService.settings.host = this.host;
        this.console.consoleService.settings.port = this.port;

        this.console.consoleService.persistSettings();
        this.console.refreshServer();

        this.console.Ui.turnOff("serverSettingsDialog");
    };
}
